(function(a){function d(b,c){var d=a(c||this).attr("class"),e=(new RegExp("(\\b"+b+")(\\S*)")).exec(d),f={"true":true,True:true,"false":false,False:false};if(e&&e.length>=3&&f[e[3]]!==undefined)e[3]=f[e[3]];return!e?undefined:e.length>=3?e[2]:null}function c(a){for(var c=0;c<arguments.length;c++){if(b(arguments[c]))return Number(parseFloat(arguments[c]))}return}function b(a){return!isNaN(parseFloat(a))}a.fn.spinbox=function(e){if(e&&typeof e==="String"&&e==="destroy")return this.unbind(".spinbox").removeClass(e.spinboxClass).removeClass(e.upClass).removeClass(e.downClass).removeClass(e.upHoverClass).removeClass(e.downHoverClass).removeData("spinboxMin").removeData("spinboxMax").removeData("spinboxReset").removeData("spinboxStep").removeData("spinboxBigStep");var f;e=a.extend({},a.fn.spinbox.defaults,e);this.each(function(){var g=a(this),h=d("spinboxMin",this),i=d("spinboxMax",this),j=d("spinboxStep",this),k=d("spinboxBigStep",this),l=d("spinboxReset",this),m=d("spinboxScale",this);if(h===f)h=c(g.attr("min"),e.min);if(i===f)i=c(g.attr("max"),e.max);if(!j)j=c(g.attr("step"),e.step);if(!k)k=c(g.attr("bigStep"),e.bigStep);if(l===f)l=c(e.reset,g.val(),h,i);if(m===f)m=g.data("spinboxScale");m=m||b(m)?m:e.scale;if(m===true)m=(j.toString().split(".")[1]||"").length;g.data("spinboxMin",h);g.data("spinboxMax",i);g.data("spinboxStep",j);g.data("spinboxBigStep",k);g.data("spinboxReset",l);g.data("spinboxScale",m)});return this.each(function(){function l(){window.clearTimeout(g);window.clearInterval(h)}function k(a,b){l();g=window.setTimeout(function(){j.apply(a,[b]);h=window.setInterval(function(){j.apply(a,[b])},e.repeat)},e.delay)}function j(d,g,h){var i=a(this);if(e.ignore&&i.is(e.ignore))return;g=c(g,i.data("spinboxStep"),1);h=h||(f?-1:1);var j=i.val();var k=c(j,i.data("spinboxReset"),0);var l=c(i.data("spinboxMin"));var m=c(i.data("spinboxMax"));var n=[k,g,l,m,h,j,e];if(h>0)k=e.increment.apply(this,n);else if(h<0)k=e.decrement.apply(this,n);if(b(i.data("spinboxScale"))&&e.round)k=e.round(k,i.data("spinboxScale"));if(b(l))k=Math.max(k,l);if(b(m))k=Math.min(k,m);var n=[k,g,l,m,h,j,e];if(k!=j&&i.triggerHandler("beforeSpin",n)!==false){i.val(k);if(e.change)i.trigger("change",n);i.triggerHandler("spin",n)}}var d,f,g,h;var i=a(this);i.bind("mousemove.spinbox",function(b){var c=a(this);var g=c.offset();var h=c.height()/2;var i=b.pageX>g.left+c.width()-e.buttonWidth;d=i&&b.pageY<=g.top+h;f=i&&b.pageY>g.top+h;c.toggleClass(e.upHoverClass,d).toggleClass(e.downHoverClass,f)}).bind("mouseout.spinbox",function(){l();a(this).removeClass([e.upClass,e.downClass,e.upHoverClass,e.downHoverClass].join(" "));d=f=null}).bind("mousedown.spinbox",function(b){if(d||f){a(this).toggleClass(e.upClass,d).toggleClass(e.downClass,f);j.apply(this,[b]);k(this,b)}}).bind("mouseup.spinbox",function(b){l();a(this).removeClass(e.upClass).removeClass(e.downClass)}).bind("keydown.spinbox",function(b){if(!e.keys||a.grep(e.keys,function(a){return a===b.keyCode||a instanceof RegExp&&a.test(String.fromCharCode(b.keyCode))}).length){var c=a(this);var d={up:38,down:40,pageUp:33,pageDown:34};var f=c.data("spinboxBigStep");var g=b.shiftKey?f:c.data("spinboxStep");switch(b.keyCode){case d.up:j.apply(this,[b,g,1]);break;case d.down:j.apply(this,[b,g,-1]);break;case d.pageUp:j.apply(this,[b,f,1]);break;case d.pageDown:j.apply(this,[b,f,-1]);break}}else return!e.keys}).bind("change.spinbox",function(a){j.apply(this,[a,0])}).addClass(e.spinboxClass);if(e.mousewheel){a(this).bind("mousewheel.spinbox DOMMouseScroll.spinbox",function(b){var c=b.shiftKey?a(this).data("spinboxBigStep"):a(this).data("spinboxStep");if(b.detail<0||b.wheelDelta>=120)j.apply(this,[b,c,1]);else if(b.detail>0||b.wheelDelta<=-120)j.apply(this,[b,c,-1]);return false})}j.apply(this,[a.Event(),0]);})};a.fn.spinbox.defaults={min:0,max:null,step:1,bigStep:10,keys:[/[0-9]/,9,13,8,46,33,34,37,38,39,40,109,188,190],ignore:"[readonly],[disabled]",spinboxClass:"spinbox-active",upClass:"spinbox-up",downClass:"spinbox-down",upHoverClass:"spinbox-up-hover",downHoverClass:"spinbox-down-hover",mousewheel:true,change:true,increment:function(a,b,c,d,e){return a+b},decrement:function(a,b,c,d,e){return a-b},reset:null,delay:500,repeat:100,buttonWidth:20,scale:true,round:function e(a,b){return Math.round(a*Math.pow(10,b))/Math.pow(10,b)}}})(jQuery);
